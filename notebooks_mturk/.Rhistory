cat(aov.apa.com, file = "lmer_output/anova_comparison_lmer_summary_free_mturk.html")
cat(aov.apa.com, file = "../../emotions_dashboard/data/anova_comparison_lmer_summary_free_mturk.html")
### get mathematical formula
formula_lmer <- extract_eq(m2)
cat(formula_lmer, file = "lmer_output/formula_lmer_summary_free_mturk.txt")
cat(formula_lmer, file = "../../emotions_dashboard/data/formula_lmer_summary_free_mturk.txt")
### get coefficient table for reporting
tab_model(m2, file = "lmer_output/lmer_summary_free_mturk.html")
tab_model(m2, file = "../../emotions_dashboard/data/lmer_summary_free_mturk.html")
(aov <- anova(m2))
aov.apa <- kable(aov, digits = 3, format = "html", caption = "ANOVA table for LMER coefficients")
cat(aov.apa, file = "lmer_output/anova_lmer_summary_free_mturk.html")
cat(aov.apa, file = "../../emotions_dashboard/data/anova_lmer_summary_free_mturk.html")
s <- svgstring()
p = ggplot(df,aes(sex,sentimentScore,color=ethnicity,group=ethnicity))+
geom_point()+
geom_smooth(method="lm",se=F)+
facet_wrap(~participantId)+
theme_bw()+
scale_color_manual(values=c("#1f77b4", "#ff7f0e"))
p
svg.string.plot <- s()
cat(svg.string.plot, file = "lmer_output/participants_charts_lmer_free_mturk.txt")
cat(svg.string.plot, file = "../../emotions_dashboard/data/participants_charts_lmer_free_mturk.txt")
dev.off()
# https://ademos.people.uic.edu/Chapter18.html
# ANOVA of the between subjects residuals.
# the assumption is that the variance is not going to differ, we would hope to see
# NO STATISTICAL DIFFERENCES in the following procedure (i.e. p>0.05)
df$Model.F.Res<- residuals(m2) #extracts the residuals and places them in a new column in our original data table
df$Abs.Model.F.Res <-abs(df$Model.F.Res) #creates a new column with the absolute value of the residuals
df$Model.F.Res2 <- df$Abs.Model.F.Res^2 #squares the absolute values of the residuals to provide the more robust estimate
Levene.Model.F <- lm(Model.F.Res2 ~ participantId, data=df) #ANOVA of the squared residuals
anova(Levene.Model.F) #displays the results
format(4.440288e-07, scientific = F)
# save to html table
aov.btw.res <- kable(anova(Levene.Model.F), digits = 3, format = "html", caption = "ANOVA table for between subjects residuals")
cat(aov.btw.res, file = "lmer_output/anova_bwt_res_summary_free_mturk.html")
cat(aov.btw.res, file = "../../emotions_dashboard/data/anova_bwt_res_summary_free_mturk.html")
s <- svgstring(width = 7,
height = 5)
Plot.Model.F <- plot(m2) #creates a fitted vs residual plot
Plot.Model.F
Plot.Model.F <- s()
cat(Plot.Model.F , file = "lmer_output/fitted_vs_residual_plot_free_mturk.txt")
cat(Plot.Model.F , file = "../../emotions_dashboard/data/fitted_vs_residual_plot_free_mturk.txt")
dev.off()
## This looks very unsystematic
resid1 <- hlm_resid(m2, level = 1, standardize = TRUE)
s <- svgstring(width = 7,
height = 5)
ggplot(data = resid1, aes(x = participantId, y = .std.ls.resid)) +
geom_point(alpha = 0.2) +
geom_smooth(method = "loess", se = FALSE) +
labs(y = "Least-Squares level-1 residuals",
title = "Least-Squares residuals by participant ID")
l1.res <- s()
cat(l1.res , file = "lmer_output/l1_res_plot_free_mturk.txt")
cat(l1.res , file = "../../emotions_dashboard/data/l1_res_plot_free_mturk.txt")
dev.off()
resid2 = hlm_resid(m2, level = "participantId", standardize = TRUE, include.ls = FALSE)
s <- svgstring(width = 7,
height = 5)
ggplot(data = resid2, aes(x = participantId, y = .std.ranef.intercept)) +
geom_point(alpha = 0.4) +
geom_smooth(method = "loess", se = FALSE) +
labs(y = "Random effects - intercept",
title = "Intercept random effects against participant ID")
l2.res.int <- s()
cat(l2.res.int , file = "lmer_output/l2_int_res_plot_free_mturk.txt")
cat(l2.res.int , file = "../../emotions_dashboard/data/l2_int_res_plot_free_mturk.txt")
dev.off()
require("lattice")
s <- svgstring(width = 7,
height = 5)
qqmath(m2, id=0.05) #id: identifies values that may be exerting undue influence on the model (i.e. outliers)
svg.qqplot <- s()
cat(svg.qqplot, file = "lmer_output/qqplot_lmer_free_mturk.txt")
cat(svg.qqplot, file = "../../emotions_dashboard/data/qqplot_lmer_free_mturk.txt")
dev.off()
infl <- hlm_influence(m2, level = 1)
# IQR = as.numeric(format(IQR(infl$cooksd)*3, scientific = F))
CutOff = 4/nrow(infl)
print(CutOff)
s <- svgstring(width = 7,
height = 5)
# dotplot_diag(infl$cooksd, name = "cooks.distance", cutoff = "internal")
dotplot_diag(infl$cooksd, name = "cooks.distance", cutoff = CutOff)
svg.string.plot <- s()
cat(svg.string.plot, file = "lmer_output/influence_datapoints_lmer_free_mturk.txt")
cat(svg.string.plot, file = "../../emotions_dashboard/data/influence_datapoints_lmer_free_mturk.txt")
dev.off()
high_cooksd = infl[infl$cooksd > CutOff, ] %>%
arrange(desc(cooksd))
head(high_cooksd, n=10)
high_cooksd$id
infl.classes <- hlm_influence(m2, level = "participantId")
CutOffGroup = 4/49
CutOffGroup
s <- svgstring(width = 7,
height = 5)
# dotplot_diag(infl.classes$cooksd, name = "cooks.distance", cutoff = "internal", modify = "dotplot")
dotplot_diag(infl.classes$cooksd, name = "cooks.distance", cutoff = CutOffGroup, modify = "dotplot")
svg.string.plot <- s()
cat(svg.string.plot, file = "lmer_output/influence_participants_lmer_free_mturk.txt")
cat(svg.string.plot, file = "../../emotions_dashboard/data/influence_participants_lmer_free_mturk.txt")
dev.off()
high_cooksd_participants = infl.classes[infl.classes$cooksd > CutOffGroup, ] %>%
arrange(desc(cooksd))
high_cooksd_participants
CutOffLeverage = mean(infl$leverage.overall)*3
CutOffLeverage
s <- svgstring(width = 7,
height = 5)
# dotplot_diag(infl$leverage.overall, name = "leverage", cutoff = "internal")
dotplot_diag(infl$leverage.overall, name = "leverage", cutoff = CutOffLeverage)
svg.string.plot <- s()
cat(svg.string.plot, file = "lmer_output/leverage_datapoints_lmer_free_mturk.txt")
cat(svg.string.plot, file = "../../emotions_dashboard/data/leverage_datapoints_lmer_free_mturk.txt")
dev.off()
high_leverage = infl[infl$leverage.overall > CutOffLeverage, ] %>%
arrange(desc(leverage.overall))
# head(high_leverage, n=10)
high_leverage
# high leverage data points
high_leverage$id
CutOffLeverageParticipants = mean(infl.classes$leverage.overall)*3
CutOffLeverageParticipants
s <- svgstring(width = 7,
height = 5)
# dotplot_diag(infl.classes$leverage.overall, name = "leverage", cutoff = "internal")
dotplot_diag(infl.classes$leverage.overall, name = "leverage", cutoff = CutOffLeverageParticipants)
svg.string.plot <- s()
cat(svg.string.plot, file = "lmer_output/leverage_participants_lmer_free_mturk.txt")
cat(svg.string.plot, file = "../../emotions_dashboard/data/leverage_participants_lmer_free_mturk.txt")
dev.off()
high_leverage_participants = infl.classes[infl.classes$leverage.overall > CutOffLeverageParticipants, ] %>%
arrange(desc(leverage.overall))
# head(high_leverage, n=10)
high_leverage_participants
high_cooksd$id
high_leverage$id
high_cooksd_participants$participantId
#add index column to data frame
df$id <- 1:nrow(df)
high_cooksd$id
high_leverage$id
high_cooksd_participants$participantId
nrow(df)
high_leverage$id
# head(high_leverage, n=10)
high_leverage_participants
high_leverage$id
`%ni%` <- Negate(`%in%`)
df.filtered <- filter(df, id %ni% high_cooksd$id)
nrow(df.filtered)
## without derivatives check
control <- lmerControl(optimizer ="Nelder_Mead", calc.derivs=FALSE, optCtrl=list(maxfun=2e6), check.nobs.vs.nRE = "ignore")
m3 <-lmer(
sentimentScore ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data = df.filtered,
control=control)
summary(m3)
### get coefficient table for reporting
tab_model(m3, file = "lmer_output/lmer_refit_summary_free_mturk.html")
tab_model(m3, file = "../../emotions_dashboard/data/lmer_refit_summary_free_mturk.html")
(aov.m3 <- anova(m3))
aov.apa.m3 <- kable(aov.m3, digits = 3, format = "html", caption = "ANOVA table for refitted LMER coefficients")
cat(aov.apa.m3, file = "lmer_output/anova_lmer_refit_summary_free_mturk.html")
cat(aov.apa.m3, file = "../../emotions_dashboard/data/anova_lmer_refit_summary_free_mturk.html")
df_students = read_csv("../clean_data/forced_choice_emotion_uw_students_long_format_lmer.csv")
table(df_students$emotion)
library(tidyverse)
library(ordinal)
library("RColorBrewer")
df_mturk = read_csv("../clean_data_mturk/forced_choice_emotion_mturk_long_format_lmer.csv")
table(df_mturk$emotion)
# drop "Other" to break tie with "Neutral" and keep ordinal variable
df <- subset(df_mturk, emotion!="Other")
table(df$emotion)
df$emotionF <- factor(df$emotion,
order = TRUE,
levels =c('Disgust', 'Anger', 'Fear', 'Sadness', 'Uncertain', 'Neutral', 'Surprise', 'Happiness'))
df$participantIdF <- as.factor(df$participantId)
df$ethnicityF <- as.factor(df$ethnicity)
df$sexF <- as.factor(df$sex)
table(df$participantIdF)
table(df$ethnicityF)
table(df$sexF)
str(df)
df <- na.omit(df)
dim(df)
RdBu8Alter <- c("#B2182B", "#D6604D", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3", "#2166AC", "#053061")
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = ethnicityF, fill = emotionF)) +
geom_bar(position = "fill") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$sex),                    # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$ethnicity),              # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
ord_m1 <- clmm2(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
ord_m2 <- clm(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
#######
# summary significant results
summary(ord_m1)
#######
# summary significant results
summary(ord_m1)
summary(ord_m2)
#######
# Get odds ratio for coefficients
exp(coef(ord_m1))
######
## sex
logit = coef(ord_m1)[8]
exp(logit) # odds ratio
plogis(logit) # probbility
######
## sex
logit = coef(ord_m1)[8]
######
## sex
logit = coef(ord_m1)[8]
exp(logit) # odds ratio
plogis(logit) # probbility
logit = coef(ord_m1)[9]
exp(logit) # odds ratio
plogis(logit) # probability
#######
# Multicolinearity
library(stats)
chisq.test(df$sexF, df$ethnicityF, correct=FALSE)
nominal_test(ord_m2)
library(tidyverse)
library(ordinal)
library("RColorBrewer")
df_mturk = read_csv("../clean_data_mturk/forced_choice_emotion_mturk_long_format_lmer.csv")
table(df_mturk$emotion)
# drop "Other" to break tie with "Neutral" and keep ordinal variable
df <- subset(df_mturk, emotion!="Other")
table(df$emotion)
#####################################
#####################################
# prepare data for ordinal lmer
#####################################
#####################################
# filter(df, sentimentScore == "-0.4404")
df$emotionF <- factor(df$emotion,
order = TRUE,
levels =c('Disgust', 'Anger', 'Fear', 'Sadness', 'Uncertain', 'Neutral', 'Surprise', 'Happiness'))
df$participantIdF <- as.factor(df$participantId)
df$ethnicityF <- as.factor(df$ethnicity)
df$sexF <- as.factor(df$sex)
table(df$participantIdF)
table(df$ethnicityF)
table(df$sexF)
str(df)
df <- na.omit(df)
dim(df)
#####################################
#####################################
# minimal plots
#####################################
#####################################
#
# display.brewer.pal(n = 10, name = "RdBu")
# brewer.pal(n = 10, name = "RdBu")
#  "#67001F" "#B2182B" "#D6604D" "#F4A582" "#FDDBC7" "#D1E5F0" "#92C5DE" "#4393C3" "#2166AC" "#053061"
RdBu8Alter <- c("#B2182B", "#D6604D", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3", "#2166AC", "#053061")
## chart for 2-way interaction SEX x ETHNICITY
two_way_sex_ethnicity <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
two_way_sex_ethnicity
two_way_sex_ethnicity <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
two_way_sex_ethnicity
s <- svgstring(width = 7,
height = 5)
#####################################
#####################################
library(svglite)
s <- svgstring(width = 7,
height = 5)
two_way_sex_ethnicity
chart <- s()
cat(chart , file = "lmer_output/sex_ethnicity_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_ethnicity_forced_mturk.txt")
dev.off()
sex_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
sex_chart
s <- svgstring(width = 7,
height = 5)
sex_chart
chart <- s()
cat(chart , file = "lmer_output/sex_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_forced_mturk.txt")
dev.off()
et_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = ethnicityF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "ethnicity", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
et_chart
s <- svgstring(width = 7,
height = 5)
et_chart
chart <- s()
cat(chart , file = "lmer_output/ethnicity_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/ethnicity_forced_mturk.txt")
dev.off()
library(tidyverse)
library(ordinal)
library("RColorBrewer")
df_mturk = read_csv("../clean_data_mturk/forced_choice_emotion_mturk_long_format_lmer.csv")
table(df_mturk$emotion)
# drop "Other" to break tie with "Neutral" and keep ordinal variable
df <- subset(df_mturk, emotion!="Other")
table(df$emotion)
#####################################
#####################################
# prepare data for ordinal lmer
#####################################
#####################################
# filter(df, sentimentScore == "-0.4404")
df$emotionF <- factor(df$emotion,
order = TRUE,
levels =c('Disgust', 'Anger', 'Fear', 'Sadness', 'Uncertain', 'Neutral', 'Surprise', 'Happiness'))
df$participantIdF <- as.factor(df$participantId)
df$ethnicityF <- as.factor(df$ethnicity)
df$sexF <- as.factor(df$sex)
table(df$participantIdF)
table(df$ethnicityF)
table(df$sexF)
str(df)
df <- na.omit(df)
dim(df)
#####################################
#####################################
# minimal plots
#####################################
#####################################
library(svglite)
#
# display.brewer.pal(n = 10, name = "RdBu")
# brewer.pal(n = 10, name = "RdBu")
#  "#67001F" "#B2182B" "#D6604D" "#F4A582" "#FDDBC7" "#D1E5F0" "#92C5DE" "#4393C3" "#2166AC" "#053061"
RdBu8Alter <- c("#B2182B", "#D6604D", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3", "#2166AC", "#053061")
## chart for 2-way interaction SEX x ETHNICITY
two_way_sex_ethnicity <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
two_way_sex_ethnicity
s <- svgstring(width = 7,
height = 5)
two_way_sex_ethnicity
chart <- s()
cat(chart , file = "lmer_output/sex_ethnicity_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_ethnicity_forced_mturk.txt")
dev.off()
## chart for effect of sex
sex_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
sex_chart
s <- svgstring(width = 7,
height = 5)
sex_chart
chart <- s()
cat(chart , file = "lmer_output/sex_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_forced_mturk.txt")
dev.off()
## chart for effect of ethnicity
et_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = ethnicityF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "ethnicity", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
et_chart
s <- svgstring(width = 7,
height = 5)
et_chart
chart <- s()
cat(chart , file = "lmer_output/ethnicity_forced_mturk.txt")
cat(chart , file = "../../emotions_dashboard/data/ethnicity_forced_mturk.txt")
dev.off()
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$sex),                    # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
# 1  female -0.1242946
# 2    male -0.1574881
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$ethnicity),              # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
# 1   bipoc -0.1374231
# 2   white -0.1441567
#####################################
#####################################
# fit lmer with ordinal approach
#####################################
#####################################
ord_m1 <- clmm2(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
# to get random effects correctly
ord_m2 <- clmm(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
# for nominal test
ord_m3 <- clm(
emotionF ~ sexC*ethnicityC + (sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
#######
# summary significant results
summary(ord_m1)
summary(ord_m2)
summary(ord_m3)
######
## sex
logit = coef(ord_m2)[8]
exp(logit) # odds ratio
plogis(logit) # probbility
#######
# Multicolinearity
library(stats)
chisq.test(df$sexF, df$ethnicityF, correct=FALSE)
nominal_test(ord_m3)
library(equatiomatic)
formula_lmer <- extract_eq(ord_m3)
cat(formula_lmer, file = "lmer_output/formula_ord_lmer_summary_forced_mturk.txt")
cat(formula_lmer, file = "../../emotions_dashboard/data/formula_ord_lmer_summary_forced_mturk.txt")
library(sjPlot)
tab_model(ord_m2, file = "lmer_output/ord_lmer_summary_forced_mturk.html")
tab_model(ord_m2, file = "../../emotions_dashboard/data/ord_lmer_summary_forced_mturk.html")
sjt.xtab(df$sexF,
df$ethnicityF,
var.labels = c("Sex", "Ethnicity"),
show.exp = TRUE,
emph.total = TRUE,
file = "lmer_output/chi_sex_et_forced_mturk.html")
sjt.xtab(df$sexF,
df$ethnicityF,
var.labels = c("Sex", "Ethnicity"),
show.exp = TRUE,
emph.total = TRUE,
file = "../../emotions_dashboard/data/chi_sex_et_forced_mturk.html")
tidy(ord_m3)
library(broom)
library(htmlTable)
tidy(ord_m3)
nominal_test(ord_m3) %>% tidy()
nominal_test(ord_m3)
nominal.test.table <- nominal_test(ord_m3) %>%
tidy() %>%
drop_na() %>%
addHtmlTableStyle(align = "r") %>%
txtRound(digits = 3) %>%
htmlTable()
nominal.test.table
cat(nominal.test.table, file = "lmer_output/nominal_test_forced_mturk.html")
cat(nominal.test.table, file = "../../emotions_dashboard/data/nominal_test_forced_mturk.html")
source("//wsl$/Ubuntu-20.04/home/pablo_ubuntu/emo-categorization/notebooks_mturk/ordinal_lmer_forced_responses_mturk.r", echo=TRUE)
