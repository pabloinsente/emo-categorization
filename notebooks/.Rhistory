c('initial_SVD', 'HD_moments', 'full_HD_PC_dist',
'HD_percentiles'), verbose=interactive())
matplot(b$initial_SVD$V[,1:2],type='l',main='Fitted PCs',lty=1)
legend('bottomright',paste0('PC',1:2),col=1:2,lty=1,lwd=2)
b<-bootSVD(Y.t, U = U, V=V, d=d, B=50, K=2, output=
c('initial_SVD', 'HD_moments', 'full_HD_PC_dist',
'HD_percentiles'), verbose=interactive())
b
b$LD_moments$momentCI
b$LD_moments$EPCs
b
b$LD_moments$EPCs[[1]]
k <- 2
# plot pointwise CIs
matplot(b$LD_moments$momentCI[[k]],type='o',col='blue',
lty=1,main=paste0('CIs For LD PC ',k),xlim=c(1,10),
xlab='PC index (truncated)',pch=1)
matlines(b$LD_percentiles[[k]],type='o',pch=1,col='darkgreen',lty=1)
abline(h=0,lty=2,col='darkgrey')
legend('topright',c('Moment CIs','Percentile CIs'),lty=1,
pch=1,col=c('blue','darkgreen'))
#plot several draws from bootstrap distribution
VsByK<-reindexMatricesByK(b$full_HD_PC_dist)
matplot(t(VsByK[[k]][1:20,]),type='l',lty=1,
main=paste0('20 Draws from bootstrap\ndistribution of HD PC ',k))
#plot pointwise CIs
matplot(b$HD_moments$momentCI[[k]],type='l',col='blue',lty=1,
main=paste0('CIs For HD PC ',k))
matlines(b$HD_percentiles[[k]],type='l',col='darkgreen',lty=1)
lines(b$initial_SVD$V[,k])
legend('topright',c('Fitted PC','Moment CIs','Percentile CIs'),
lty=1,col=c('black','blue','darkgreen'))
abline(h=0,lty=2,col='darkgrey')
#plot pointwise CIs
matplot(b$HD_moments$momentCI[[k]],type='l',col='blue',lty=1,
main=paste0('CIs For HD PC ',k))
matlines(b$HD_percentiles[[k]],type='l',col='darkgreen',lty=1)
lines(b$initial_SVD$V[,k])
legend('topright',c('Fitted PC','Moment CIs','Percentile CIs'),
lty=1,col=c('black','blue','darkgreen'))
abline(h=0,lty=2,col='darkgrey')
matplot(b$LD_moments$momentCI[[k]],type='o',col='blue',
lty=1,main=paste0('CIs For LD PC ',k),xlim=c(1,10),
xlab='PC index (truncated)',pch=1)
matlines(b$LD_percentiles[[k]],type='o',pch=1,col='darkgreen',lty=1)
abline(h=0,lty=2,col='darkgrey')
legend('topright',c('Moment CIs','Percentile CIs'),lty=1,
pch=1,col=c('blue','darkgreen'))
#plot several draws from bootstrap distribution
VsByK<-reindexMatricesByK(b$full_HD_PC_dist)
matplot(t(VsByK[[k]][1:20,]),type='l',lty=1,
main=paste0('20 Draws from bootstrap\ndistribution of HD PC ',k))
#plot pointwise CIs
matplot(b$HD_moments$momentCI[[k]],type='l',col='blue',lty=1,
main=paste0('CIs For HD PC ',k))
matlines(b$HD_percentiles[[k]],type='l',col='darkgreen',lty=1)
lines(b$initial_SVD$V[,k])
legend('topright',c('Fitted PC','Moment CIs','Percentile CIs'),
lty=1,col=c('black','blue','darkgreen'))
abline(h=0,lty=2,col='darkgrey')
# plot several draws from bootstrap distribution
AsByK<-reindexMatricesByK(b$full_LD_PC_dist)
matplot(t(AsByK[[k]][1:50,]),type='l',lty=1,
main=paste0('50 Draws from bootstrap\ndistribution of LD PC ',k),
xlim=c(1,10),xlab='PC index (truncated)')
# plot pointwise CIs
matplot(b$LD_moments$momentCI[[k]],type='o',col='blue',
lty=1,main=paste0('CIs For LD PC ',k),xlim=c(1,10),
xlab='PC index (truncated)',pch=1)
matlines(b$LD_percentiles[[k]],type='o',pch=1,col='darkgreen',lty=1)
abline(h=0,lty=2,col='darkgrey')
legend('topright',c('Moment CIs','Percentile CIs'),lty=1,
pch=1,col=c('blue','darkgreen'))
#Note: variability is mostly due to rotations with the third and fourth PC.
# Bootstrap eigenvalue distribution
dsByK<-reindexVectorsByK(b$d_dist)
boxplot(dsByK[[k]]^2,main=paste0('Covariance Matrix Eigenvalue ',k),
ylab='Bootstrap Distribution',
ylim=range(c(dsByK[[k]]^2,b$initial_SVD$d[k]^2)))
points(b$initial_SVD$d[k]^2,pch=18,col='red')
legend('bottomright','Sample Value',pch=18,col='red')
df.pca = read_csv('../clean_data/pca_2d_forced_all.csv')
df.pca
test.1=summary(aov(x_pca~label, data=df.pca))
test.2=summary(aov(y_pca~label, data=df.pca))
test.1
test.2
test.1[[1]][1,2]
ssTreat.x = test.1[[1]][1,2]
ssError.x = test.1[[1]][2,2]
dfTreat.x = test.1[[1]][1,1]
dfError.x = test.1[[1]][2,1]
ssTreat.y = test.2[[1]][1,2]
ssError.y = test.2[[1]][2,2]
dfTreat.y = test.2[[1]][1,1]
dfError.y = test.2[[1]][2,1]
# D. Add Sums of Square for overall test
sumSS.trtmnt=(ssTreat.x+ssTreat.y)/(dfTreat.x+dfTreat.y)
sumSS.error=(ssError.x+ssError.y)/(dfError.x+dfError.y)
# F-test
F.all =sumSS.trtmnt/mean.error
install.packages("remotes")
remotes::install_github("villardon/MultBiplotR")
# install.packages("remotes")
# remotes::install_github("villardon/MultBiplotR")
library(MultBiplotR)
Y
pcaboot=PCA.Bootstrap(Y.m, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
grupo=wine$Group
grupo
rownames(X)=paste(1:45, grupo, sep="-")
X=wine[,4:21]
X
rownames(X)=paste(1:45, grupo, sep="-")
rownames
rownames(X)
## Not run: X=wine[,4:21]
grupo=wine$Group
rownames(X)=paste(1:45, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
X=wine[,4:21]
grupo=wine$Group
rownames(X)=paste(1:45, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
X
grupo
df
df$emotion
forced_choice_df$emotion
forced_choice_df
forced_choice_df$label
forced_choice_df
## Not run:
X=forced_choice_df[,1:8]
X
dim(grupo)
length(grupo)
grupo=forced_choice_df$label
grupo
length(grupo)
rownames(X)=paste(1:194, grupo, sep="-")
X
type(wine)
typeof(wine)
wine
typeof(X)
typeof(forced_choice_df)
## Not run:
X=forced_choice_df[,1:8]
grupo=forced_choice_df$label
rownames(X)=paste(1:194, grupo, sep="-")
X
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
X=wine[,4:21]
grupo=wine$Group
rownames(X)=paste(1:45, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
X=wine[,4:21]
grupo=wine$Group
rownames(X)=paste(1:45, grupo, sep="-")
wine
forced_choice_df
as.data.frame(forced_choice_df)
## Not run:
forced_choice_df_DT = as.data.frame(forced_choice_df)
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
rownames(X)=paste(1:194, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
getOption("max.print")
plot(pcaboot, ColorInd=as.numeric(grupo))
dim(pcaboot)
pcaboot
## Not run:
forced_choice_df_DT = as.data.frame(forced_choice_df)
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
rownames(X)=paste(1:194, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
plot(pcaboot, ColorInd=as.numeric(grupo))
as.numeric(grupo)
wine$Group
as.numeric(wine$Group)
X=wine[,4:21]
grupo=wine$Group
rownames(X)=paste(1:45, grupo, sep="-")
as.numeric(grupo)
X
grupo
X=forced_choice_df_DT[,1:8]
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
grupo
forced_choice_df_DT[forced_choice_df_DT$label == "disgust",]$group = 1
forced_choice_df_DT[forced_choice_df_DT$label == "anger",]$group = 2
forced_choice_df_DT
## Not run:
forced_choice_df_DT = as.data.frame(forced_choice_df)
forced_choice_df_DT <- DropNA(forced_choice_df_DT)
forced_choice_df_DT %>% drop_na()
forced_choice_df_DT <- forced_choice_df_DT %>% drop_na()
dim(forced_choice_df_DT)
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
rownames(X)=paste(1:194, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
grupo
X
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
rownames(X)=paste(1:194, grupo, sep="-")
rownames(X)=paste(1:192, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$label
rownames(X)=paste(1:192, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
names(X)
forced_choice_df_DT$group <- forced_choice_df_DT$label
forced_choice_df_DT$group  <- mapvalues(forced_choice_df_DT$group , from=c("happiness", "neutral","surprise","sadness", "disgust", "anger", "fear", "uncertain"), to=c(1, 2, 3, 4, 5, 6, 7, 8))
install.packages('plyr')
install.packages("plyr")
library(plyr)
forced_choice_df_DT$group  <- mapvalues(forced_choice_df_DT$group , from=c("happiness", "neutral","surprise","sadness", "disgust", "anger", "fear", "uncertain"), to=c(1, 2, 3, 4, 5, 6, 7, 8))
forced_choice_df_DT
X=forced_choice_df_DT[,1:8]
grupo=forced_choice_df_DT$group
rownames(X)=paste(1:192, grupo, sep="-")
pcaboot=PCA.Bootstrap(X, dimens=2, Scaling = "Standardize columns", B=1000)
plot(pcaboot, ColorInd=as.numeric(grupo))
summary(pcaboot)
df_students$emotion
library(tidyverse)
library(ordinal)
library("RColorBrewer")
library(ggeffects)
df_students = read_csv("../clean_data/forced_choice_emotion_uw_students_long_format_lmer.csv")
df_students$emotion
table(df_students$emotion)
df %>% filter(row(emotion) ==  Other)
df %>% filter(row(emotion) ==  'Other')
df_students %>% filter(row(emotion) ==  'Other')
df_students[ which(df_students$emotion=='Other'), ]
df_students[ which(df_students$emotion!='Other'), ]
dim(df_students)
df_students = read_csv("../clean_data/forced_choice_emotion_uw_students_long_format_lmer.csv")
table(df_students$emotion)
dim(df_students)
df_students[ which(df_students$emotion!='Other'), ]
dim(df_students)
dim(df_students)
table(df$emotion)
df_students = read_csv("../clean_data/forced_choice_emotion_uw_students_long_format_lmer.csv")
table(df_students$emotion)
df <- subset(df, emotion!="Other")
table(df$emotion)
df$emotionF <- factor(df$emotion,
order = TRUE,
levels =c('Disgust', 'Anger', 'Fear', 'Sadness', 'Uncertain', 'Neutral', 'Surprise', 'Happiness'))
df$participantIdF <- as.factor(df$participantId)
df$ethnicityF <- as.factor(df$ethnicity)
df$sexF <- as.factor(df$sex)
table(df$participantIdF)
table(df$ethnicityF)
table(df$sexF)
str(df)
df <- na.omit(df)
dim(df)
RdBu8Alter <- c("#B2182B", "#D6604D", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3", "#2166AC", "#053061")
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = ethnicutyF, fill = emotionF)) +
geom_bar(position = "fill") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
df %>% mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>% ggplot( aes(x = ethnicityF, fill = emotionF)) +
geom_bar(position = "fill") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$sex),                    # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$ethnicity),              # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
ord_m1 <- clmm2(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
ord_m2 <- clm(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
#######
# summary significant results
summary(ord_m1)
summary(ord_m2)
#######
# Get odds ratio for coefficients
exp(coef(ord_m1))
######
## sex ** NOT significant
logit = coef(ord_m1)[8]
exp(logit) # odds ratio
logit2prob(logit) # probability
plogis(logit) # probbility
logit = coef(ord_m1)[9]
exp(logit) # odds ratio
logit2prob(logit) # probability
plogis(logit) # probability
logit = coef(ord_m1)[10]
exp(logit) # odds ratio
plogis(logit)
#######
# Multicolinearity
library(stats)
chisq.test(df$sexF, df$ethnicityF, correct=FALSE)
nominal_test(ord_m2)
library(tidyverse)
library(ordinal)
library("RColorBrewer")
df_students = read_csv("../clean_data/forced_choice_emotion_uw_students_long_format_lmer.csv")
table(df_students$emotion)
# drop "Other" to break tie with "Neutral" and keep ordinal variable
df <- subset(df_students, emotion!="Other")
table(df$emotion)
#####################################
#####################################
# prepare data for ordinal lmer
#####################################
#####################################
# filter(df, sentimentScore == "-0.4404")
df$emotionF <- factor(df$emotion,
order = TRUE,
levels =c('Disgust', 'Anger', 'Fear', 'Sadness', 'Uncertain', 'Neutral', 'Surprise', 'Happiness'))
df$participantIdF <- as.factor(df$participantId)
df$ethnicityF <- as.factor(df$ethnicity)
df$sexF <- as.factor(df$sex)
table(df$participantIdF)
table(df$ethnicityF)
table(df$sexF)
str(df)
df <- na.omit(df)
dim(df)
#####################################
#####################################
library(svglite)
two_way_sex_ethnicity <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
RdBu8Alter <- c("#B2182B", "#D6604D", "#F7F7F7", "#D1E5F0", "#92C5DE", "#4393C3", "#2166AC", "#053061")
two_way_sex_ethnicity <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
facet_grid(. ~ethnicityF) +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
two_way_sex_ethnicity
s <- svgstring(width = 7,
height = 5)
two_way_sex_ethnicity
chart <- s()
cat(chart , file = "lmer_output/sex_ethnicity_forced.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_ethnicity_forced.txt")
dev.off()
sex_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = sexF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "sex", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
sex_chart
s <- svgstring(width = 7,
height = 5)
sex_chart
chart <- s()
cat(chart , file = "lmer_output/sex_forced_mturk.txt")
dev.off()
s <- svgstring(width = 7,
height = 5)
sex_chart
chart <- s()
cat(chart , file = "lmer_output/sex_forced.txt")
cat(chart , file = "../../emotions_dashboard/data/sex_forced.txt")
dev.off()
et_chart <- df %>%
mutate(emotionF = ordered(emotionF, levels=rev(levels(emotionF)))) %>%
ggplot( aes(x = ethnicityF, fill = emotionF)) +
geom_bar(position = "fill") +
labs(y = "proportion", x = "ethnicity", fill ="emotion") +
scale_fill_manual(values = RdBu8Alter) +
theme_minimal()
et_chart
s <- svgstring(width = 7,
height = 5)
et_chart
chart <- s()
cat(chart , file = "lmer_output/ethnicity_forced.txt")
cat(chart , file = "../../emotions_dashboard/data/ethnicity_forced.txt")
dev.off()
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$sex),                    # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
aggregate(x = df$sentimentScore,                # Specify data column
by = list(df$ethnicity),              # Specify group indicator
FUN = mean)                           # Specify function (i.e. mean)
ord_m1 <- clmm2(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
ord_m1 <- clmm2(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
# to get random effects correctly
ord_m2 <- clmm(
emotionF ~ 1 + sexC*ethnicityC + (1 + sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
# for nominal test
ord_m3 <- clm(
emotionF ~ sexC*ethnicityC + (sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
# for nominal test
ord_m3 <- clm(
emotionF ~ sexC*ethnicityC + (sexC*ethnicityC|participantId),
data=df,
Hess = TRUE)
#######
# summary significant results
summary(ord_m1)
summary(ord_m2)
summary(ord_m3)
######
## sex
logit = coef(ord_m2)[8]
exp(logit) # odds ratio
plogis(logit) # probbility
logit = coef(ord_m2)[9]
exp(logit) # odds ratio
plogis(logit) # probability
logit = coef(ord_m2)[10]
exp(logit) # odds ratio
plogis(logit) # probability
#######
# Multicolinearity
library(stats)
chisq.test(df$sexF, df$ethnicityF, correct=FALSE)
nominal_test(ord_m3)
library(equatiomatic)
formula_lmer <- extract_eq(ord_m3)
cat(formula_lmer, file = "lmer_output/formula_ord_lmer_summary_forced.txt")
cat(formula_lmer, file = "../../emotions_dashboard/data/formula_ord_lmer_summary_forced.txt")
library(sjPlot)
tab_model(ord_m2, file = "lmer_output/ord_lmer_summary_forced.html")
tab_model(ord_m2, file = "../../emotions_dashboard/data/ord_lmer_summary_forced.html")
sjt.xtab(df$sexF,
df$ethnicityF,
var.labels = c("Sex", "Ethnicity"),
show.exp = TRUE,
emph.total = TRUE,
file = "lmer_output/chi_sex_et_forced.html")
sjt.xtab(df$sexF,
df$ethnicityF,
var.labels = c("Sex", "Ethnicity"),
show.exp = TRUE,
emph.total = TRUE,
file = "../../emotions_dashboard/data/chi_sex_et_forced.html")
library(broom)
library(htmlTable)
nominal.test.table <- nominal_test(ord_m3) %>%
tidy() %>%
drop_na() %>%
addHtmlTableStyle(align = "r") %>%
txtRound(digits = 3) %>%
htmlTable()
nominal.test.table
cat(nominal.test.table, file = "lmer_output/nominal_test_forced.html")
cat(nominal.test.table, file = "../../emotions_dashboard/data/nominal_test_forced.html")
source("//wsl$/Ubuntu-20.04/home/pablo_ubuntu/emo-categorization/notebooks/ordinal_lmer_forced_responses.r", echo=TRUE)
